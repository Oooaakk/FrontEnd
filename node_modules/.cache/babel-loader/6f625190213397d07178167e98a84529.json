{"ast":null,"code":"import \"core-js/modules/es.error.cause.js\";\nimport { getCodeImg, sendMail, registerData, forgetData, updatePass } from \"@/api/login\";\nimport Cookies from \"js-cookie\";\nimport { encrypt, decrypt } from \"@/utils/jsencrypt\";\nimport Verify from \"@/components/Verifition/Verify.vue\";\nimport userAvatar from \"@/components/userAvatar\";\nexport default {\n  __name: 'ForgetPassword',\n\n  setup(__props, {\n    expose\n  }) {\n    expose();\n    const store = useStore();\n    const router = useRouter();\n    const {\n      proxy\n    } = getCurrentInstance(); // 登录\n\n    const loginForm = ref({\n      password: \"\",\n      phone: '',\n      rememberMe: false,\n      code: \"\",\n      uuid: \"\"\n    });\n\n    const confirmPassword = (rule, value, callback) => {\n      if (!value) {\n        callback(new Error(\"密码不能为空\"));\n      } else {\n        callback();\n      }\n    };\n\n    const confirmPhone = (rule, value, callback) => {\n      if (!value) {\n        callback(new Error(\"手机号码不能为空\"));\n      } else if (value !== 'admin') {\n        if (value.search(/^[0-9]{11}$/) == -1) {\n          callback(new Error(\"手机号码格式不正确!\"));\n        } else {\n          callback();\n        }\n      } else {\n        callback();\n      }\n    };\n\n    const loginRules = ref({\n      password: [{\n        validator: confirmPassword,\n        required: true,\n        trigger: \"blur\"\n      }, {\n        pattern: /^(?=.*[a-zA-Z])(?=.*\\d).{8,12}$/,\n        message: \"密码必须包含字母、数字,长度8到14位\",\n        trigger: \"blur\"\n      }],\n      phone: [{\n        validator: confirmPhone,\n        required: true,\n        trigger: \"blur\"\n      }]\n    }); // 忘记密码\n\n    const formForgetPwd = ref({\n      email: '',\n      code: '',\n      password: '',\n      confirmPassword: ''\n    });\n\n    const confirmForgetPwd = (rule, value, callback) => {\n      if (!value) {\n        callback(new Error(\"请输入确认密码\"));\n      } else if (value !== formForgetPwd.value.password) {\n        callback(new Error(\"两次输入密码不一致!\"));\n      } else {\n        callback();\n      }\n    };\n\n    const rulesForgetPwd = {\n      email: [{\n        required: true,\n        trigger: \"blur\",\n        message: \"邮箱不能为空\"\n      }, {\n        pattern: /^\\w+([-+.]\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*$/,\n        message: \"邮箱格式不正确\",\n        trigger: \"blur\"\n      }],\n      code: [{\n        required: true,\n        trigger: \"blur\",\n        message: \"邮箱验证码不能为空\"\n      }],\n      password: [{\n        required: true,\n        trigger: \"blur\",\n        message: \"密码不能为空\"\n      }, {\n        pattern: /^(?=.*[a-zA-Z])(?=.*\\d).{8,12}$/,\n        message: \"密码必须包含字母、数字,长度8到14位\",\n        trigger: \"blur\"\n      }],\n      confirmPassword: [{\n        validator: confirmForgetPwd,\n        required: true,\n        trigger: \"blur\"\n      }]\n    }; // 注册\n\n    const formData = ref({\n      nickName: '',\n      phonenumber: '',\n      email: '',\n      code: '',\n      password: '',\n      confirmPassword: ''\n    });\n\n    const confirmRegPwd = (rule, value, callback) => {\n      if (!value) {\n        callback(new Error(\"请输入确认密码\"));\n      } else if (value !== formData.value.password) {\n        callback(new Error(\"两次输入密码不一致!\"));\n      } else {\n        callback();\n      }\n    };\n\n    const confirmEmail = (rule, value, callback) => {\n      if (!value) {\n        callback(new Error(\"邮箱不能为空\"));\n      } else if (value !== 'admin') {\n        if (value.search(/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/) == -1) {\n          callback(new Error(\"邮箱格式不正确!\"));\n        } else {\n          callback();\n        }\n      } else {\n        callback();\n      }\n    };\n\n    const confirmCode = (rule, value, callback) => {\n      if (!value) {\n        callback(new Error(\"邮箱验证码不能为空\"));\n      } else {\n        callback();\n      }\n    };\n\n    const rules = ref({\n      nickName: [{\n        required: true,\n        trigger: \"blur\",\n        message: \"用户名不能为空\"\n      }],\n      phonenumber: [{\n        required: true,\n        trigger: \"blur\",\n        message: \"手机号码不能为空\"\n      }, {\n        pattern: /^[0-9]{11}$/,\n        message: \"手机号码格式不正确\",\n        trigger: \"blur\"\n      }],\n      email: [// { required: true, trigger: \"blur\", message: \"邮箱不能为空\" },\n      // {\n      //   pattern:/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/,\n      //   message: \"邮箱格式不正确\",\n      //   trigger: \"blur\",\n      // }\n      {\n        validator: confirmEmail,\n        required: true,\n        trigger: \"blur\"\n      }],\n      code: [// { required: true, trigger: \"blur\", message: \"邮箱验证码不能为空\" },\n      {\n        validator: confirmCode,\n        required: true,\n        trigger: \"blur\"\n      }],\n      password: [{\n        required: true,\n        trigger: \"blur\",\n        message: \"密码不能为空\"\n      }, {\n        pattern: /^(?=.*[a-zA-Z])(?=.*\\d).{8,12}$/,\n        message: \"密码必须包含字母、数字,长度8到14位\",\n        trigger: \"blur\"\n      }],\n      confirmPassword: [{\n        validator: confirmRegPwd,\n        required: true,\n        trigger: \"blur\"\n      }]\n    });\n    const isback = ref(false);\n    const step = ref(1);\n    const flag = ref(0);\n    const codeUrl = ref(\"\");\n    const loading = ref(false); // // 验证码开关\n    // const captchaOnOff = ref(true);\n    // 注册开关\n\n    const register = ref(false);\n    const redirect = ref(undefined);\n    const loginRef = ref(null);\n    const countD = ref(60);\n    const isSend = ref(true); // 登录\n\n    function handleLogin() {\n      loginRef.value.validate(valid => {\n        if (valid) {\n          proxy.$refs.verify.show();\n        }\n      });\n    } // 返回登录\n\n\n    function backLogin() {\n      loginRef.value.resetFields();\n      flag.value = 0;\n      countD.value = 60;\n      isSend.value = true;\n    }\n\n    ; // 忘记密码\n\n    function registerBtn() {\n      proxy.$refs.ForgetPwdRef.resetFields();\n      flag.value = 2;\n      step.value = 1;\n    }\n\n    function submitForgetPwd() {\n      proxy.$refs.ForgetPwdRef.validate(valid => {\n        if (valid) {\n          let data = {\n            email: formForgetPwd.value.email,\n            code: formForgetPwd.value.code\n          };\n          forgetData(data).then(res => {\n            console.log(res);\n            step.value = 2;\n          });\n        }\n      });\n    }\n\n    function updatePassFunc() {\n      proxy.$refs.ForgetPwdRef.validate(valid => {\n        if (valid) {\n          let data = {\n            email: formForgetPwd.value.email,\n            password: formForgetPwd.value.password\n          };\n          updatePass(data).then(res => {\n            console.log(res);\n            proxy.$modal.msgSuccess(\"修改密码成功\");\n            flag.value = 0;\n          });\n        }\n      });\n    } // 定时器\n\n\n    function countDFun() {\n      let countDown = setInterval(() => {\n        let code = flag.value == 1 ? formData.value.code : formForgetPwd.value.code;\n\n        if (countD.value == 0) {\n          clearInterval(countDown); // getEmailCode(formData.value.email);\n\n          isSend.value = true;\n          countD.value = 60;\n        } else if (countD.value > 0) {\n          countD.value = countD.value - 1;\n        }\n      }, 1000);\n    }\n\n    ; // 注册展示\n\n    function forgetPwd() {\n      proxy.$refs.baseInfoForm.resetFields();\n      flag.value = 1;\n    } // 邮箱验证码\n\n\n    function getEmailCode(em) {\n      if (em.search(/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/) != -1) {\n        let email = {\n          email: em\n        };\n        isSend.value = false; // 倒计时\n\n        countDFun();\n        sendMail(email).then(res => {\n          proxy.$modal.msgSuccess(\"验证码已发送,请注意查收\");\n          console.log(res);\n        });\n      } else if (em == '') {\n        proxy.$modal.msgError('邮箱不能为空');\n      }\n    } // 注册\n\n\n    function registerFunc() {\n      proxy.$refs.baseInfoForm.validate(valid => {\n        if (valid) {\n          let data = {\n            userName: formData.value.nickName,\n            phonenumber: formData.value.phonenumber,\n            email: formData.value.email,\n            code: formData.value.code,\n            password: formData.value.password\n          };\n          registerData(data).then(res => {\n            console.log(res);\n            proxy.$modal.msgSuccess(\"注册成功\"); // 返回登录并渲染输入框\n\n            flag.value = 0;\n            loginForm.value.phone = data.phonenumber;\n            loginForm.value.password = data.password;\n            isback.value = true;\n          });\n        }\n      });\n    } // 图片验证码\n\n\n    function getCode() {\n      getCodeImg().then(res => {\n        captchaOnOff.value = res.captchaOnOff === undefined ? true : res.captchaOnOff;\n\n        if (captchaOnOff.value) {\n          codeUrl.value = \"data:image/gif;base64,\" + res.img;\n          loginForm.value.uuid = res.uuid;\n        }\n      });\n    } // 获取缓存\n\n\n    function getCookie() {\n      // const username = Cookies.get(\"username\");\n      const password = Cookies.get(\"password\");\n      const rememberMe = Cookies.get(\"rememberMe\");\n      const phone = Cookies.get(\"phone\");\n      loginForm.value = {\n        phone: phone === undefined ? loginForm.value.phone : phone,\n        // username: username === undefined ? loginForm.value.username : username,\n        password: password === undefined ? loginForm.value.password : decrypt(password),\n        rememberMe: rememberMe === undefined ? false : Boolean(rememberMe)\n      };\n    } // 记住密码\n\n\n    function capctchaCheckSuccess(params) {\n      loginForm.value.code = params.captchaVerification;\n      loading.value = true; // 勾选了需要记住密码设置在cookie中设置记住用户明和名命\n\n      if (loginForm.value.rememberMe) {\n        Cookies.set(\"phone\", loginForm.value.phone, {\n          expires: 30\n        }); // Cookies.set(\"username\", loginForm.value.username, { expires: 30 });\n\n        Cookies.set(\"password\", encrypt(loginForm.value.password), {\n          expires: 30\n        });\n        Cookies.set(\"rememberMe\", loginForm.value.rememberMe, {\n          expires: 30\n        });\n      } else {\n        // 否则移除\n        Cookies.remove(\"phone\"); // Cookies.remove(\"username\");\n\n        Cookies.remove(\"password\");\n        Cookies.remove(\"rememberMe\");\n      }\n\n      let data = {\n        username: loginForm.value.phone,\n        password: loginForm.value.password,\n        code: loginForm.value.code,\n        uuid: loginForm.value.uuid\n      }; // 调用action的登录方法\n\n      store.dispatch(\"Login\", data).then(() => {\n        router.push({\n          path: redirect.value || \"/\"\n        });\n      }).catch(() => {\n        loading.value = false; // 否则移除\n\n        Cookies.remove(\"phone\"); // Cookies.remove(\"username\");\n\n        Cookies.remove(\"password\");\n        Cookies.remove(\"rememberMe\");\n        loginForm.value.phone = '';\n        loginForm.value.password = '';\n        loginForm.value.rememberMe = false;\n      });\n    }\n\n    getCookie();\n    const __returned__ = {\n      store,\n      router,\n      proxy,\n      loginForm,\n      confirmPassword,\n      confirmPhone,\n      loginRules,\n      formForgetPwd,\n      confirmForgetPwd,\n      rulesForgetPwd,\n      formData,\n      confirmRegPwd,\n      confirmEmail,\n      confirmCode,\n      rules,\n      isback,\n      step,\n      flag,\n      codeUrl,\n      loading,\n      register,\n      redirect,\n      loginRef,\n      countD,\n      isSend,\n      handleLogin,\n      backLogin,\n      registerBtn,\n      submitForgetPwd,\n      updatePassFunc,\n      countDFun,\n      forgetPwd,\n      getEmailCode,\n      registerFunc,\n      getCode,\n      getCookie,\n      capctchaCheckSuccess,\n      getCodeImg,\n      sendMail,\n      registerData,\n      forgetData,\n      updatePass,\n      Cookies,\n      encrypt,\n      decrypt,\n      Verify,\n      userAvatar\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n\n};","map":{"version":3,"mappings":";AAoSA,SAASA,UAAT,EAAoBC,QAApB,EAA6BC,YAA7B,EAA0CC,UAA1C,EAAqDC,UAArD,QAAuE,aAAvE;AACA,OAAOC,OAAP,MAAoB,WAApB;AACA,SAASC,OAAT,EAAkBC,OAAlB,QAAiC,mBAAjC;AACA,OAAOC,MAAP,MAAmB,oCAAnB;AACA,OAAOC,UAAP,MAAuB,yBAAvB;;;;;;;;IAEA,MAAMC,KAAK,GAAGC,QAAQ,EAAtB;IACA,MAAMC,MAAM,GAAGC,SAAS,EAAxB;IACA,MAAM;MAAEC;IAAF,IAAYC,kBAAkB,EAApC,EACA;;IACA,MAAMC,SAAS,GAAGC,GAAG,CAAC;MACpBC,QAAQ,EAAE,EADU;MAEpBC,KAAK,EAAC,EAFc;MAGpBC,UAAU,EAAE,KAHQ;MAIpBC,IAAI,EAAE,EAJc;MAKpBC,IAAI,EAAE;IALc,CAAD,CAArB;;IAOA,MAAMC,eAAe,GAAG,CAACC,IAAD,EAAOC,KAAP,EAAcC,QAAd,KAA2B;MACjD,IAAI,CAACD,KAAL,EAAY;QACVC,QAAQ,CAAC,IAAIC,KAAJ,CAAU,QAAV,CAAD,CAAR;MACD,CAFD,MAEO;QACLD,QAAQ;MACT;IACF,CAND;;IAOA,MAAME,YAAY,GAAG,CAACJ,IAAD,EAAOC,KAAP,EAAcC,QAAd,KAA2B;MAC9C,IAAI,CAACD,KAAL,EAAY;QACVC,QAAQ,CAAC,IAAIC,KAAJ,CAAU,UAAV,CAAD,CAAR;MACD,CAFD,MAEO,IAAIF,KAAK,KAAK,OAAd,EAAuB;QAC5B,IAAGA,KAAK,CAACI,MAAN,CAAa,aAAb,KAA+B,CAAC,CAAnC,EAAqC;UACnCH,QAAQ,CAAC,IAAIC,KAAJ,CAAU,YAAV,CAAD,CAAR;QACD,CAFD,MAEK;UACHD,QAAQ;QACT;MACF,CANM,MAMA;QACLA,QAAQ;MACT;IACF,CAZD;;IAaA,MAAMI,UAAU,GAAGb,GAAG,CAAC;MACrBC,QAAQ,EAAE,CAAC;QAAEa,SAAS,EAAER,eAAb;QAA8BS,QAAQ,EAAE,IAAxC;QAA8CC,OAAO,EAAE;MAAvD,CAAD,EAAiE;QACzEC,OAAO,EAAE,iCADgE;QAEzEC,OAAO,EAAE,qBAFgE;QAGzEF,OAAO,EAAE;MAHgE,CAAjE,CADW;MAMrBd,KAAK,EAAE,CAAC;QAAEY,SAAS,EAAEH,YAAb;QAA2BI,QAAQ,EAAE,IAArC;QAA2CC,OAAO,EAAE;MAApD,CAAD;IANc,CAAD,CAAtB,EAQA;;IACA,MAAMG,aAAa,GAAGnB,GAAG,CAAC;MACxBoB,KAAK,EAAE,EADiB;MAExBhB,IAAI,EAAE,EAFkB;MAGxBH,QAAQ,EAAC,EAHe;MAIxBK,eAAe,EAAC;IAJQ,CAAD,CAAzB;;IAMA,MAAMe,gBAAgB,GAAG,CAACd,IAAD,EAAOC,KAAP,EAAcC,QAAd,KAA2B;MAClD,IAAI,CAACD,KAAL,EAAY;QACVC,QAAQ,CAAC,IAAIC,KAAJ,CAAU,SAAV,CAAD,CAAR;MACD,CAFD,MAEO,IAAIF,KAAK,KAAKW,aAAa,CAACX,KAAd,CAAoBP,QAAlC,EAA4C;QACjDQ,QAAQ,CAAC,IAAIC,KAAJ,CAAU,YAAV,CAAD,CAAR;MACD,CAFM,MAEA;QACLD,QAAQ;MACT;IACF,CARD;;IASA,MAAMa,cAAc,GAAG;MACrBF,KAAK,EAAC,CACJ;QAAEL,QAAQ,EAAE,IAAZ;QAAkBC,OAAO,EAAE,MAA3B;QAAmCE,OAAO,EAAE;MAA5C,CADI,EAEJ;QACED,OAAO,EAAE,+CADX;QAEEC,OAAO,EAAE,SAFX;QAGEF,OAAO,EAAE;MAHX,CAFI,CADe;MASrBZ,IAAI,EAAC,CACH;QAAEW,QAAQ,EAAE,IAAZ;QAAkBC,OAAO,EAAE,MAA3B;QAAmCE,OAAO,EAAE;MAA5C,CADG,CATgB;MAYrBjB,QAAQ,EAAC,CACP;QAAEc,QAAQ,EAAE,IAAZ;QAAkBC,OAAO,EAAE,MAA3B;QAAmCE,OAAO,EAAE;MAA5C,CADO,EAEP;QACED,OAAO,EAAE,iCADX;QAEEC,OAAO,EAAE,qBAFX;QAGEF,OAAO,EAAE;MAHX,CAFO,CAZY;MAoBrBV,eAAe,EAAE,CAAC;QAAEQ,SAAS,EAAEO,gBAAb;QAA+BN,QAAQ,EAAE,IAAzC;QAA+CC,OAAO,EAAE;MAAxD,CAAD;IApBI,CAAvB,EAuBA;;IACA,MAAMO,QAAQ,GAAGvB,GAAG,CAAC;MACnBwB,QAAQ,EAAC,EADU;MAEnBC,WAAW,EAAC,EAFO;MAGnBL,KAAK,EAAC,EAHa;MAInBhB,IAAI,EAAC,EAJc;MAKnBH,QAAQ,EAAC,EALU;MAMnBK,eAAe,EAAC;IANG,CAAD,CAApB;;IAQA,MAAMoB,aAAa,GAAG,CAACnB,IAAD,EAAOC,KAAP,EAAcC,QAAd,KAA2B;MAC/C,IAAI,CAACD,KAAL,EAAY;QACVC,QAAQ,CAAC,IAAIC,KAAJ,CAAU,SAAV,CAAD,CAAR;MACD,CAFD,MAEO,IAAIF,KAAK,KAAKe,QAAQ,CAACf,KAAT,CAAeP,QAA7B,EAAuC;QAC5CQ,QAAQ,CAAC,IAAIC,KAAJ,CAAU,YAAV,CAAD,CAAR;MACD,CAFM,MAEA;QACLD,QAAQ;MACT;IACF,CARD;;IAWA,MAAMkB,YAAY,GAAG,CAACpB,IAAD,EAAOC,KAAP,EAAcC,QAAd,KAA2B;MAC9C,IAAI,CAACD,KAAL,EAAY;QACVC,QAAQ,CAAC,IAAIC,KAAJ,CAAU,QAAV,CAAD,CAAR;MACD,CAFD,MAEO,IAAIF,KAAK,KAAK,OAAd,EAAuB;QAC5B,IAAGA,KAAK,CAACI,MAAN,CAAa,qDAAb,KAAuE,CAAC,CAA3E,EAA6E;UAC3EH,QAAQ,CAAC,IAAIC,KAAJ,CAAU,UAAV,CAAD,CAAR;QACD,CAFD,MAEK;UACHD,QAAQ;QACT;MACF,CANM,MAMA;QACLA,QAAQ;MACT;IACF,CAZD;;IAaA,MAAMmB,WAAW,GAAG,CAACrB,IAAD,EAAOC,KAAP,EAAcC,QAAd,KAA2B;MAC7C,IAAI,CAACD,KAAL,EAAY;QACVC,QAAQ,CAAC,IAAIC,KAAJ,CAAU,WAAV,CAAD,CAAR;MAED,CAHD,MAGO;QACLD,QAAQ;MACT;IACF,CAPD;;IAQA,MAAMoB,KAAK,GAAG7B,GAAG,CAAC;MAChBwB,QAAQ,EAAE,CACR;QAAET,QAAQ,EAAE,IAAZ;QAAkBC,OAAO,EAAE,MAA3B;QAAmCE,OAAO,EAAE;MAA5C,CADQ,CADM;MAIhBO,WAAW,EAAC,CACV;QAAEV,QAAQ,EAAE,IAAZ;QAAkBC,OAAO,EAAE,MAA3B;QAAmCE,OAAO,EAAE;MAA5C,CADU,EAEV;QACED,OAAO,EAAE,aADX;QAEEC,OAAO,EAAE,WAFX;QAGEF,OAAO,EAAE;MAHX,CAFU,CAJI;MAYhBI,KAAK,EAAC,CACJ;MACA;MACA;MACA;MACA;MACA;MACA;QAAEN,SAAS,EAAEa,YAAb;QAA2BZ,QAAQ,EAAE,IAArC;QAA2CC,OAAO,EAAE;MAApD,CAPI,CAZU;MAqBhBZ,IAAI,EAAC,CACH;MACA;QAAEU,SAAS,EAAEc,WAAb;QAA0Bb,QAAQ,EAAE,IAApC;QAA0CC,OAAO,EAAE;MAAnD,CAFG,CArBW;MAyBhBf,QAAQ,EAAC,CACP;QAAEc,QAAQ,EAAE,IAAZ;QAAkBC,OAAO,EAAE,MAA3B;QAAmCE,OAAO,EAAE;MAA5C,CADO,EAEP;QACED,OAAO,EAAE,iCADX;QAEEC,OAAO,EAAE,qBAFX;QAGEF,OAAO,EAAE;MAHX,CAFO,CAzBO;MAiChBV,eAAe,EAAE,CAAC;QAAEQ,SAAS,EAAEY,aAAb;QAA4BX,QAAQ,EAAE,IAAtC;QAA4CC,OAAO,EAAE;MAArD,CAAD;IAjCD,CAAD,CAAjB;IAmCA,MAAMc,MAAM,GAAG9B,GAAG,CAAC,KAAD,CAAlB;IACA,MAAM+B,IAAI,GAAG/B,GAAG,CAAC,CAAD,CAAhB;IACA,MAAMgC,IAAI,GAAGhC,GAAG,CAAC,CAAD,CAAhB;IACA,MAAMiC,OAAO,GAAGjC,GAAG,CAAC,EAAD,CAAnB;IACA,MAAMkC,OAAO,GAAGlC,GAAG,CAAC,KAAD,CAAnB,EACA;IACA;IACA;;IACA,MAAMmC,QAAQ,GAAGnC,GAAG,CAAC,KAAD,CAApB;IACA,MAAMoC,QAAQ,GAAGpC,GAAG,CAACqC,SAAD,CAApB;IACA,MAAMC,QAAQ,GAAGtC,GAAG,CAAC,IAAD,CAApB;IACA,MAAMuC,MAAM,GAAGvC,GAAG,CAAC,EAAD,CAAlB;IACA,MAAMwC,MAAM,GAAGxC,GAAG,CAAC,IAAD,CAAlB,EAEA;;IACA,SAASyC,WAAT,GAAuB;MACrBH,QAAQ,CAAC9B,KAAT,CAAekC,QAAf,CAAwBC,KAAK,IAAI;QAC/B,IAAGA,KAAH,EAAS;UACP9C,KAAK,CAAC+C,KAAN,CAAYC,MAAZ,CAAmBC,IAAnB;QACD;MACF,CAJD;IAKD,EAED;;;IACA,SAASC,SAAT,GAAoB;MAClBT,QAAQ,CAAC9B,KAAT,CAAewC,WAAf;MACAhB,IAAI,CAACxB,KAAL,GAAa,CAAb;MACA+B,MAAM,CAAC/B,KAAP,GAAe,EAAf;MACAgC,MAAM,CAAChC,KAAP,GAAe,IAAf;IACD;;IAAA,EAED;;IACA,SAASyC,WAAT,GAAuB;MACrBpD,KAAK,CAAC+C,KAAN,CAAYM,YAAZ,CAAyBF,WAAzB;MACAhB,IAAI,CAACxB,KAAL,GAAa,CAAb;MACAuB,IAAI,CAACvB,KAAL,GAAa,CAAb;IACD;;IACD,SAAS2C,eAAT,GAA0B;MACxBtD,KAAK,CAAC+C,KAAN,CAAYM,YAAZ,CAAyBR,QAAzB,CAAkCC,KAAK,IAAI;QACzC,IAAIA,KAAJ,EAAW;UACT,IAAIS,IAAI,GAAG;YACThC,KAAK,EAAED,aAAa,CAACX,KAAd,CAAoBY,KADlB;YAEThB,IAAI,EAAEe,aAAa,CAACX,KAAd,CAAoBJ;UAFjB,CAAX;UAIAlB,UAAU,CAACkE,IAAD,CAAV,CAAiBC,IAAjB,CAAsBC,GAAG,IAAE;YACzBC,OAAO,CAACC,GAAR,CAAYF,GAAZ;YACAvB,IAAI,CAACvB,KAAL,GAAa,CAAb;UACD,CAHD;QAID;MACF,CAXD;IAYD;;IACD,SAASiD,cAAT,GAAyB;MACvB5D,KAAK,CAAC+C,KAAN,CAAYM,YAAZ,CAAyBR,QAAzB,CAAkCC,KAAK,IAAI;QACzC,IAAIA,KAAJ,EAAW;UACT,IAAIS,IAAI,GAAG;YACThC,KAAK,EAAED,aAAa,CAACX,KAAd,CAAoBY,KADlB;YAETnB,QAAQ,EAAEkB,aAAa,CAACX,KAAd,CAAoBP;UAFrB,CAAX;UAIAd,UAAU,CAACiE,IAAD,CAAV,CAAiBC,IAAjB,CAAsBC,GAAG,IAAE;YACzBC,OAAO,CAACC,GAAR,CAAYF,GAAZ;YACAzD,KAAK,CAAC6D,MAAN,CAAaC,UAAb,CAAwB,QAAxB;YACA3B,IAAI,CAACxB,KAAL,GAAa,CAAb;UACD,CAJD;QAKD;MACF,CAZD;IAaD,EACD;;;IACA,SAASoD,SAAT,GAAoB;MAElB,IAAIC,SAAS,GAAGC,WAAW,CAAC,MAAI;QAC9B,IAAI1D,IAAI,GAAG4B,IAAI,CAACxB,KAAL,IAAc,CAAd,GAAkBe,QAAQ,CAACf,KAAT,CAAeJ,IAAjC,GAAwCe,aAAa,CAACX,KAAd,CAAoBJ,IAAvE;;QACA,IAAGmC,MAAM,CAAC/B,KAAP,IAAgB,CAAnB,EAAqB;UACnBuD,aAAa,CAACF,SAAD,CAAb,CADmB,CAEnB;;UACArB,MAAM,CAAChC,KAAP,GAAe,IAAf;UACA+B,MAAM,CAAC/B,KAAP,GAAe,EAAf;QACD,CALD,MAKM,IAAG+B,MAAM,CAAC/B,KAAP,GAAe,CAAlB,EAAoB;UACxB+B,MAAM,CAAC/B,KAAP,GAAe+B,MAAM,CAAC/B,KAAP,GAAe,CAA9B;QACD;MACF,CAV0B,EAUzB,IAVyB,CAA3B;IAaD;;IAAA,EACD;;IACA,SAASwD,SAAT,GAAqB;MACnBnE,KAAK,CAAC+C,KAAN,CAAYqB,YAAZ,CAAyBjB,WAAzB;MACAhB,IAAI,CAACxB,KAAL,GAAa,CAAb;IACD,EACD;;;IACA,SAAS0D,YAAT,CAAsBC,EAAtB,EAAyB;MACvB,IAAGA,EAAE,CAACvD,MAAH,CAAU,qDAAV,KAAoE,CAAC,CAAxE,EAA0E;QACxE,IAAIQ,KAAK,GAAG;UAACA,KAAK,EAAE+C;QAAR,CAAZ;QACA3B,MAAM,CAAChC,KAAP,GAAc,KAAd,CAFwE,CAGxE;;QACAoD,SAAS;QACT5E,QAAQ,CAACoC,KAAD,CAAR,CAAgBiC,IAAhB,CAAqBC,GAAG,IAAE;UACxBzD,KAAK,CAAC6D,MAAN,CAAaC,UAAb,CAAwB,cAAxB;UACAJ,OAAO,CAACC,GAAR,CAAYF,GAAZ;QACD,CAHD;MAID,CATD,MASM,IAAGa,EAAE,IAAI,EAAT,EAAY;QAChBtE,KAAK,CAAC6D,MAAN,CAAaU,QAAb,CAAsB,QAAtB;MACD;IACF,EACD;;;IACA,SAASC,YAAT,GAAuB;MACrBxE,KAAK,CAAC+C,KAAN,CAAYqB,YAAZ,CAAyBvB,QAAzB,CAAkCC,KAAK,IAAI;QACzC,IAAIA,KAAJ,EAAW;UACT,IAAIS,IAAI,GAAG;YACTkB,QAAQ,EAAE/C,QAAQ,CAACf,KAAT,CAAegB,QADhB;YAETC,WAAW,EAAEF,QAAQ,CAACf,KAAT,CAAeiB,WAFnB;YAGTL,KAAK,EAAEG,QAAQ,CAACf,KAAT,CAAeY,KAHb;YAIThB,IAAI,EAAEmB,QAAQ,CAACf,KAAT,CAAeJ,IAJZ;YAKTH,QAAQ,EAAEsB,QAAQ,CAACf,KAAT,CAAeP;UALhB,CAAX;UAOAhB,YAAY,CAACmE,IAAD,CAAZ,CAAmBC,IAAnB,CAAwBC,GAAG,IAAE;YAE3BC,OAAO,CAACC,GAAR,CAAYF,GAAZ;YACAzD,KAAK,CAAC6D,MAAN,CAAaC,UAAb,CAAwB,MAAxB,EAH2B,CAI3B;;YACA3B,IAAI,CAACxB,KAAL,GAAa,CAAb;YACAT,SAAS,CAACS,KAAV,CAAgBN,KAAhB,GAAwBkD,IAAI,CAAC3B,WAA7B;YACA1B,SAAS,CAACS,KAAV,CAAgBP,QAAhB,GAA2BmD,IAAI,CAACnD,QAAhC;YACA6B,MAAM,CAACtB,KAAP,GAAe,IAAf;UACD,CATD;QAUD;MACF,CApBD;IAqBD,EAQD;;;IACA,SAAS+D,OAAT,GAAmB;MACjBxF,UAAU,GAAGsE,IAAb,CAAkBC,GAAG,IAAI;QACvBkB,YAAY,CAAChE,KAAb,GAAqB8C,GAAG,CAACkB,YAAJ,KAAqBnC,SAArB,GAAiC,IAAjC,GAAwCiB,GAAG,CAACkB,YAAjE;;QACA,IAAIA,YAAY,CAAChE,KAAjB,EAAwB;UACtByB,OAAO,CAACzB,KAAR,GAAgB,2BAA2B8C,GAAG,CAACmB,GAA/C;UACA1E,SAAS,CAACS,KAAV,CAAgBH,IAAhB,GAAuBiD,GAAG,CAACjD,IAA3B;QACD;MACF,CAND;IAOD,EAED;;;IACA,SAASqE,SAAT,GAAqB;MACnB;MACA,MAAMzE,QAAQ,GAAGb,OAAO,CAACuF,GAAR,CAAY,UAAZ,CAAjB;MACA,MAAMxE,UAAU,GAAGf,OAAO,CAACuF,GAAR,CAAY,YAAZ,CAAnB;MACA,MAAMzE,KAAK,GAAGd,OAAO,CAACuF,GAAR,CAAY,OAAZ,CAAd;MACA5E,SAAS,CAACS,KAAV,GAAkB;QAChBN,KAAK,EAAEA,KAAK,KAAKmC,SAAV,GAAsBtC,SAAS,CAACS,KAAV,CAAgBN,KAAtC,GAA8CA,KADrC;QAEhB;QACAD,QAAQ,EAAEA,QAAQ,KAAKoC,SAAb,GAAyBtC,SAAS,CAACS,KAAV,CAAgBP,QAAzC,GAAoDX,OAAO,CAACW,QAAD,CAHrD;QAIhBE,UAAU,EAAEA,UAAU,KAAKkC,SAAf,GAA2B,KAA3B,GAAmCuC,OAAO,CAACzE,UAAD;MAJtC,CAAlB;IAMD,EACD;;;IACA,SAAS0E,oBAAT,CAA8BC,MAA9B,EAAsC;MACpC/E,SAAS,CAACS,KAAV,CAAgBJ,IAAhB,GAAuB0E,MAAM,CAACC,mBAA9B;MACA7C,OAAO,CAAC1B,KAAR,GAAgB,IAAhB,CAFoC,CAGpC;;MACA,IAAIT,SAAS,CAACS,KAAV,CAAgBL,UAApB,EAAgC;QAC9Bf,OAAO,CAAC4F,GAAR,CAAY,OAAZ,EAAqBjF,SAAS,CAACS,KAAV,CAAgBN,KAArC,EAA4C;UAAE+E,OAAO,EAAE;QAAX,CAA5C,EAD8B,CAE9B;;QACA7F,OAAO,CAAC4F,GAAR,CAAY,UAAZ,EAAwB3F,OAAO,CAACU,SAAS,CAACS,KAAV,CAAgBP,QAAjB,CAA/B,EAA2D;UAAEgF,OAAO,EAAE;QAAX,CAA3D;QACA7F,OAAO,CAAC4F,GAAR,CAAY,YAAZ,EAA0BjF,SAAS,CAACS,KAAV,CAAgBL,UAA1C,EAAsD;UAAE8E,OAAO,EAAE;QAAX,CAAtD;MACD,CALD,MAKO;QACL;QACA7F,OAAO,CAAC8F,MAAR,CAAe,OAAf,EAFK,CAGL;;QACA9F,OAAO,CAAC8F,MAAR,CAAe,UAAf;QACA9F,OAAO,CAAC8F,MAAR,CAAe,YAAf;MACD;;MAED,IAAI9B,IAAI,GAAG;QACT+B,QAAQ,EAAGpF,SAAS,CAACS,KAAV,CAAgBN,KADlB;QAETD,QAAQ,EAAEF,SAAS,CAACS,KAAV,CAAgBP,QAFjB;QAGTG,IAAI,EAAEL,SAAS,CAACS,KAAV,CAAgBJ,IAHb;QAITC,IAAI,EAAEN,SAAS,CAACS,KAAV,CAAgBH;MAJb,CAAX,CAjBoC,CAwBpC;;MACAZ,KAAK,CAAC2F,QAAN,CAAe,OAAf,EAAwBhC,IAAxB,EAA8BC,IAA9B,CAAmC,MAAM;QACvC1D,MAAM,CAAC0F,IAAP,CAAY;UAAEC,IAAI,EAAElD,QAAQ,CAAC5B,KAAT,IAAkB;QAA1B,CAAZ;MACD,CAFD,EAEG+E,KAFH,CAES,MAAM;QACbrD,OAAO,CAAC1B,KAAR,GAAgB,KAAhB,CADa,CAEb;;QACApB,OAAO,CAAC8F,MAAR,CAAe,OAAf,EAHa,CAIb;;QACA9F,OAAO,CAAC8F,MAAR,CAAe,UAAf;QACA9F,OAAO,CAAC8F,MAAR,CAAe,YAAf;QAEAnF,SAAS,CAACS,KAAV,CAAgBN,KAAhB,GAAwB,EAAxB;QACAH,SAAS,CAACS,KAAV,CAAgBP,QAAhB,GAA2B,EAA3B;QACAF,SAAS,CAACS,KAAV,CAAgBL,UAAhB,GAA6B,KAA7B;MACD,CAbD;IAcD;;IAEDuE,SAAS","names":["getCodeImg","sendMail","registerData","forgetData","updatePass","Cookies","encrypt","decrypt","Verify","userAvatar","store","useStore","router","useRouter","proxy","getCurrentInstance","loginForm","ref","password","phone","rememberMe","code","uuid","confirmPassword","rule","value","callback","Error","confirmPhone","search","loginRules","validator","required","trigger","pattern","message","formForgetPwd","email","confirmForgetPwd","rulesForgetPwd","formData","nickName","phonenumber","confirmRegPwd","confirmEmail","confirmCode","rules","isback","step","flag","codeUrl","loading","register","redirect","undefined","loginRef","countD","isSend","handleLogin","validate","valid","$refs","verify","show","backLogin","resetFields","registerBtn","ForgetPwdRef","submitForgetPwd","data","then","res","console","log","updatePassFunc","$modal","msgSuccess","countDFun","countDown","setInterval","clearInterval","forgetPwd","baseInfoForm","getEmailCode","em","msgError","registerFunc","userName","getCode","captchaOnOff","img","getCookie","get","Boolean","capctchaCheckSuccess","params","captchaVerification","set","expires","remove","username","dispatch","push","path","catch"],"sources":["D:/comp30022 frontend/comp30022-movie-review-website/moviehub_frontend/src/views/ForgetPassword.vue"],"sourcesContent":["<template>\r\n  <div class=\"crmLogin\">\r\n    <div class=\"top-box\">\r\n      <img src=\"@/assets/login/logo.png\"/>\r\n    </div>\r\n    <div class=\"mid-box\">\r\n      <div v-show=\"flag == 0\" class=\"login_cont\">\r\n        <div class=\"loginNewBg\">\r\n          <img src=\"@/assets/login/login-bg.png\"/>\r\n          <div class=\"log_content\">\r\n            <div class=\"wel\">北大***预约系统</div>\r\n            <el-form\r\n                :hide-required-asterisk=\"true\"\r\n                ref=\"loginRef\"\r\n                :model=\"loginForm\"\r\n                :rules=\"loginRules\"\r\n                label-position=\"top\"\r\n            >\r\n              <el-form-item label=\"手机号码\" prop=\"phone\">\r\n                <el-input\r\n                    v-model.trim=\"loginForm.phone\"\r\n                    placeholder=\"请输入手机号码\"\r\n                    :maxlength=\"11\"\r\n                    clearable\r\n                >\r\n                  <template #prefix>\r\n                    <img src=\"@/assets/login/phone-icon.png\">\r\n                  </template>\r\n                </el-input>\r\n              </el-form-item>\r\n              <el-form-item label=\"登录密码\" prop=\"password\" class=\"password\">\r\n                <el-input\r\n                    v-model.trim=\"loginForm.password\"\r\n                    prefix-icon=\"el-icon-unlock\"\r\n                    size=\"default\"\r\n                    type=\"password\"\r\n                    auto-complete=\"off\"\r\n                    @keyup.enter.native=\"handleLogin\"\r\n                    placeholder=\"请输入密码\"\r\n                >\r\n                  <template #prefix>\r\n                    <img src=\"@/assets/login/pad-icon.png\">\r\n                  </template>\r\n                </el-input>\r\n                <div class=\"a\"></div>\r\n              </el-form-item>\r\n              <div class=\"flx al_c just_between\">\r\n                <el-checkbox v-model=\"loginForm.rememberMe\">记住密码</el-checkbox>\r\n                <div @click=\"registerBtn()\" class=\"pass-btn\" style=\"cursor: pointer;\">忘记密码</div>\r\n              </div>\r\n              <el-form-item style=\"width: 100%;margin-top: 22px;\">\r\n                <el-button\r\n                    :loading=\"loading\"\r\n                    style=\"\r\n                  width: 100%;\r\n                  color: #fff;\r\n                  border: 0;\r\n                \"\r\n                    @click.native.prevent=\"handleLogin\"\r\n                >\r\n                  <span v-if=\"!loading\">登 录</span>\r\n                  <span v-else>登 录 中...</span>\r\n                </el-button>\r\n              </el-form-item>\r\n              <div @click=\"forgetPwd()\" class=\"register-btn\">\r\n                没有账号?<span>点击注册</span>\r\n              </div>\r\n            </el-form>\r\n            <Verify\r\n                @success=\"capctchaCheckSuccess\"\r\n                :mode=\"'pop'\"\r\n                :captchaType=\"'blockPuzzle'\"\r\n                :imgSize=\"{ width: '330px', height: '155px' }\"\r\n                ref=\"verify\"\r\n            ></Verify>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <!-- 注册 -->\r\n      <div  class=\"login_cont\" v-show=\"flag == 1\">\r\n        <div class=\"loginNewBg\">\r\n          <img src=\"@/assets/login/login-bg.png\"/>\r\n          <div class=\" register\">\r\n              <div class=\"top\">\r\n                <div class=\"pageName\">北大***预约系统</div>\r\n              </div>\r\n              <div class=\"regBox\">\r\n                <el-form\r\n                    ref=\"baseInfoForm\"\r\n                    :model=\"formData\"\r\n                    :rules=\"rules\"\r\n                    size=\"default\"\r\n                    label-width=\"100px\"\r\n                    label-position=\"top\"\r\n                >\r\n                  <el-form-item label=\"姓名\" prop=\"nickName\">\r\n                    <el-input v-model=\"formData.nickName\" placeholder=\"请输入姓名\" :maxlength=\"30\" clearable>\r\n                      <template #prefix>\r\n                        <img src=\"@/assets/login/user-icon.png\">\r\n                      </template>\r\n \r\n                    </el-input>\r\n                  </el-form-item>\r\n                  <el-form-item label=\"手机号码\" prop=\"phonenumber\">\r\n                    <el-input\r\n                        v-model.trim=\"formData.phonenumber\"\r\n                        placeholder=\"请输入手机号码\"\r\n                        :maxlength=\"11\"\r\n                        clearable\r\n                    >\r\n                      <template #prefix>\r\n                        <img src=\"@/assets/login/phone-icon.png\">\r\n                      </template>\r\n                    </el-input>\r\n                  </el-form-item>\r\n                  <el-form-item label=\"邮箱\" prop=\"email\">\r\n                    <el-input\r\n                        v-model.trim=\"formData.email\"\r\n                        placeholder=\"请输入邮箱\"\r\n                        :maxlength=\"30\"\r\n                        clearable\r\n                    >\r\n                      <template #prefix>\r\n                        <img src=\"@/assets/login/em-icon.png\">\r\n                      </template>\r\n                    </el-input>\r\n                  </el-form-item>\r\n                  <el-form-item label=\"邮箱验证码\" prop=\"code\" class=\"email-code\">\r\n                    <el-input\r\n                        v-model.trim=\"formData.code\"\r\n                        placeholder=\"请输入邮箱验证码\"\r\n                        :maxlength=\"30\"\r\n                        clearable\r\n                    >\r\n                      <template #prefix>\r\n                        <img src=\"@/assets/login/code-icon.png\">\r\n                      </template>\r\n                    </el-input>\r\n                    <el-button type=\"primary\" plain @click=\"getEmailCode(formData.email)\" :disabled=\"isSend? false: true\">\r\n                      <span v-if=\"isSend\">发送验证码</span>\r\n                      <span v-else>{{countD}}s重新发送</span>\r\n                    </el-button>\r\n                  </el-form-item>\r\n                  <el-form-item label=\"密码\" prop=\"password\">\r\n                    <el-input\r\n                        v-model.trim=\"formData.password\"\r\n                        placeholder=\"请输入密码\"\r\n                        :maxlength=\"30\"\r\n                        type=\"password\"\r\n                        clearable\r\n                    >\r\n                      <template #prefix>\r\n                        <img src=\"@/assets/login/pad-icon.png\">\r\n                      </template>\r\n                    </el-input>\r\n                  </el-form-item>\r\n                  <el-form-item label=\"确认密码\" prop=\"confirmPassword\">\r\n                    <el-input\r\n                        v-model.trim=\"formData.confirmPassword\"\r\n                        placeholder=\"请输入确认密码\"\r\n                        type=\"password\"\r\n                        :maxlength=\"30\"\r\n                        clearable\r\n                    >\r\n                      <template #prefix>\r\n                        <img src=\"@/assets/login/pad-icon.png\">\r\n                      </template>\r\n                    </el-input>\r\n                  </el-form-item>\r\n                </el-form>\r\n              </div>\r\n \r\n              <div class=\"reg-btns\">\r\n          <el-button type=\"primary\" @click=\"registerFunc\">注册</el-button>\r\n          <div class=\"back-btn\" @click=\"backLogin\">返回登录>></div>\r\n        </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <!-- 忘记密码   -->\r\n      <div class=\"login_cont\" v-show=\"flag == 2\">\r\n        <div class=\"loginNewBg\">\r\n          <img src=\"@/assets/login/login-bg.png\"/>\r\n          <div class=\"log_content\" style=\"padding: 60px;height:auto;border-radius: 10px;\">\r\n            <div class=\"wel\">北大***预约系统</div>\r\n            <div>\r\n              <el-form\r\n                  ref=\"ForgetPwdRef\"\r\n                  :model=\"formForgetPwd\"\r\n                  :rules=\"rulesForgetPwd\"\r\n                  size=\"default\"\r\n                  label-position=\"top\"\r\n              >\r\n                <div v-if=\"step == 1\">\r\n                  <el-form-item label=\"邮箱\" prop=\"email\">\r\n                    <el-input\r\n                        v-model.trim=\"formForgetPwd.email\"\r\n                        placeholder=\"请输入邮箱\"\r\n                        :maxlength=\"30\"\r\n                        clearable\r\n                    >\r\n                      <template #prefix>\r\n                        <img src=\"@/assets/login/em-icon.png\">\r\n                      </template>\r\n                    </el-input>\r\n                  </el-form-item>\r\n                  <el-form-item label=\"邮箱验证码\" prop=\"code\">\r\n                    <el-input\r\n                        v-model.trim=\"formForgetPwd.code\"\r\n                        placeholder=\"请输入邮箱验证码\"\r\n                        :maxlength=\"30\"\r\n                        clearable\r\n                        style=\"width: 224px !important;margin-right: 10px\"\r\n                    >\r\n                      <template #prefix>\r\n                        <img src=\"@/assets/login/code-icon.png\">\r\n                      </template>\r\n                    </el-input>\r\n                    <el-button type=\"primary\" plain @click=\"getEmailCode(formForgetPwd.email)\" :disabled=\"isSend? false: true\">\r\n                      <span v-if=\"isSend\">发送验证码</span>\r\n                      <span v-else>{{countD}}s重新发送</span>\r\n                    </el-button>\r\n                  </el-form-item>\r\n                  <el-form-item>\r\n                    <el-button\r\n                        type=\"primary\"\r\n                        size=\"default\"\r\n                        @click=\"submitForgetPwd\"\r\n                        style=\"width: 100%\"\r\n                    >确定</el-button>\r\n                  </el-form-item>\r\n                </div>\r\n \r\n \r\n                <div v-else>\r\n                  <span>您的邮箱为: {{formForgetPwd.email}}</span>\r\n                  <el-form-item label=\"新密码\" prop=\"password\"  style=\"margin-top: 6px\">\r\n                    <el-input\r\n                        v-model.trim=\"formForgetPwd.password\"\r\n                        placeholder=\"请输入新密码\"\r\n                        :maxlength=\"30\"\r\n                        type=\"password\"\r\n                        clearable\r\n                    >\r\n                      <template #prefix>\r\n                        <img src=\"@/assets/login/pad-icon.png\">\r\n                      </template>\r\n                    </el-input>\r\n                  </el-form-item>\r\n                  <el-form-item label=\"确认密码\" prop=\"confirmPassword\">\r\n                    <el-input\r\n                        v-model.trim=\"formForgetPwd.confirmPassword\"\r\n                        placeholder=\"请输入确认密码\"\r\n                        type=\"password\"\r\n                        :maxlength=\"30\"\r\n                        clearable\r\n                    >\r\n                      <template #prefix>\r\n                        <img src=\"@/assets/login/pad-icon.png\">\r\n                      </template>\r\n                    </el-input>\r\n                  </el-form-item>\r\n                  <el-form-item>\r\n                    <el-button\r\n                        type=\"primary\"\r\n                        size=\"default\"\r\n                        @click=\"updatePassFunc\"\r\n                        style=\"width: 100%\"\r\n                    >确定</el-button>\r\n                  </el-form-item>\r\n \r\n                </div>\r\n \r\n \r\n                <div style=\"text-align: center;\">\r\n                  已有账号？马上\r\n                  <span @click=\"backLogin\" style=\"color: #1678FF;cursor:pointer\">登录</span>\r\n                </div>\r\n              </el-form>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div class=\"log_bottom\">\r\n      <div>系统支持主流浏览器、火狐、谷歌、360极速</div>\r\n       <div>北京盛元广通科技有限公司 Copyright©2016-2022 ***系统 版权所有</div>\r\n    </div>\r\n  </div>\r\n</template>\r\n \r\n<script setup>\r\nimport { getCodeImg,sendMail,registerData,forgetData,updatePass } from \"@/api/login\";\r\nimport Cookies from \"js-cookie\";\r\nimport { encrypt, decrypt } from \"@/utils/jsencrypt\";\r\nimport Verify from \"@/components/Verifition/Verify.vue\";\r\nimport userAvatar from \"@/components/userAvatar\";\r\n \r\nconst store = useStore();\r\nconst router = useRouter();\r\nconst { proxy } = getCurrentInstance();\r\n// 登录\r\nconst loginForm = ref({\r\n  password: \"\",\r\n  phone:'',\r\n  rememberMe: false,\r\n  code: \"\",\r\n  uuid: \"\"\r\n});\r\nconst confirmPassword = (rule, value, callback) => {\r\n  if (!value) {\r\n    callback(new Error(\"密码不能为空\"));\r\n  } else {\r\n    callback();\r\n  }\r\n};\r\nconst confirmPhone = (rule, value, callback) => {\r\n  if (!value) {\r\n    callback(new Error(\"手机号码不能为空\"));\r\n  } else if (value !== 'admin') {\r\n    if(value.search(/^[0-9]{11}$/) == -1){\r\n      callback(new Error(\"手机号码格式不正确!\"));\r\n    }else{\r\n      callback();\r\n    }\r\n  } else {\r\n    callback();\r\n  }\r\n};\r\nconst loginRules = ref({\r\n  password: [{ validator: confirmPassword, required: true, trigger: \"blur\" },{\r\n    pattern: /^(?=.*[a-zA-Z])(?=.*\\d).{8,12}$/,\r\n    message: \"密码必须包含字母、数字,长度8到14位\",\r\n    trigger: \"blur\",\r\n  },],\r\n  phone: [{ validator: confirmPhone, required: true, trigger: \"blur\" },]\r\n});\r\n// 忘记密码\r\nconst formForgetPwd = ref({\r\n  email: '',\r\n  code: '',\r\n  password:'',\r\n  confirmPassword:''\r\n});\r\nconst confirmForgetPwd = (rule, value, callback) => {\r\n  if (!value) {\r\n    callback(new Error(\"请输入确认密码\"));\r\n  } else if (value !== formForgetPwd.value.password) {\r\n    callback(new Error(\"两次输入密码不一致!\"));\r\n  } else {\r\n    callback();\r\n  }\r\n};\r\nconst rulesForgetPwd = {\r\n  email:[\r\n    { required: true, trigger: \"blur\", message: \"邮箱不能为空\" },\r\n    {\r\n      pattern: /^\\w+([-+.]\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*$/,\r\n      message: \"邮箱格式不正确\",\r\n      trigger: \"blur\",\r\n    }\r\n  ],\r\n  code:[\r\n    { required: true, trigger: \"blur\", message: \"邮箱验证码不能为空\" },\r\n  ],\r\n  password:[\r\n    { required: true, trigger: \"blur\", message: \"密码不能为空\" },\r\n    {\r\n      pattern: /^(?=.*[a-zA-Z])(?=.*\\d).{8,12}$/,\r\n      message: \"密码必须包含字母、数字,长度8到14位\",\r\n      trigger: \"blur\",\r\n    }\r\n  ],\r\n  confirmPassword: [{ validator: confirmForgetPwd, required: true, trigger: \"blur\" },]\r\n}\r\n \r\n// 注册\r\nconst formData = ref({\r\n  nickName:'',\r\n  phonenumber:'',\r\n  email:'',\r\n  code:'',\r\n  password:'',\r\n  confirmPassword:''\r\n});\r\nconst confirmRegPwd = (rule, value, callback) => {\r\n  if (!value) {\r\n    callback(new Error(\"请输入确认密码\"));\r\n  } else if (value !== formData.value.password) {\r\n    callback(new Error(\"两次输入密码不一致!\"));\r\n  } else {\r\n    callback();\r\n  }\r\n};\r\n \r\n \r\nconst confirmEmail = (rule, value, callback) => {\r\n  if (!value) {\r\n    callback(new Error(\"邮箱不能为空\"));\r\n  } else if (value !== 'admin') {\r\n    if(value.search(/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/) == -1){\r\n      callback(new Error(\"邮箱格式不正确!\"));\r\n    }else{\r\n      callback();\r\n    }\r\n  } else {\r\n    callback();\r\n  }\r\n};\r\nconst confirmCode = (rule, value, callback) => {\r\n  if (!value) {\r\n    callback(new Error(\"邮箱验证码不能为空\"));\r\n \r\n  } else {\r\n    callback();\r\n  }\r\n};\r\nconst rules = ref({\r\n  nickName: [\r\n    { required: true, trigger: \"blur\", message: \"用户名不能为空\" },\r\n  ],\r\n  phonenumber:[\r\n    { required: true, trigger: \"blur\", message: \"手机号码不能为空\" },\r\n    {\r\n      pattern: /^[0-9]{11}$/,\r\n      message: \"手机号码格式不正确\",\r\n      trigger: \"blur\",\r\n    }\r\n  ],\r\n  email:[\r\n    // { required: true, trigger: \"blur\", message: \"邮箱不能为空\" },\r\n    // {\r\n    //   pattern:/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/,\r\n    //   message: \"邮箱格式不正确\",\r\n    //   trigger: \"blur\",\r\n    // }\r\n    { validator: confirmEmail, required: true, trigger: \"blur\" }\r\n  ],\r\n  code:[\r\n    // { required: true, trigger: \"blur\", message: \"邮箱验证码不能为空\" },\r\n    { validator: confirmCode, required: true, trigger: \"blur\" }\r\n  ],\r\n  password:[\r\n    { required: true, trigger: \"blur\", message: \"密码不能为空\" },\r\n    {\r\n      pattern: /^(?=.*[a-zA-Z])(?=.*\\d).{8,12}$/,\r\n      message: \"密码必须包含字母、数字,长度8到14位\",\r\n      trigger: \"blur\",\r\n    }\r\n  ],\r\n  confirmPassword: [{ validator: confirmRegPwd, required: true, trigger: \"blur\" }]\r\n});\r\nconst isback = ref(false)\r\nconst step = ref(1);\r\nconst flag = ref(0);\r\nconst codeUrl = ref(\"\");\r\nconst loading = ref(false);\r\n// // 验证码开关\r\n// const captchaOnOff = ref(true);\r\n// 注册开关\r\nconst register = ref(false);\r\nconst redirect = ref(undefined);\r\nconst loginRef = ref(null)\r\nconst countD = ref(60)\r\nconst isSend = ref(true)\r\n \r\n// 登录\r\nfunction handleLogin() {\r\n  loginRef.value.validate(valid => {\r\n    if(valid){\r\n      proxy.$refs.verify.show();\r\n    }\r\n  })\r\n}\r\n \r\n// 返回登录\r\nfunction backLogin(){\r\n  loginRef.value.resetFields()\r\n  flag.value = 0;\r\n  countD.value = 60\r\n  isSend.value = true\r\n};\r\n \r\n// 忘记密码\r\nfunction registerBtn() {\r\n  proxy.$refs.ForgetPwdRef.resetFields()\r\n  flag.value = 2;\r\n  step.value = 1;\r\n}\r\nfunction submitForgetPwd(){\r\n  proxy.$refs.ForgetPwdRef.validate(valid => {\r\n    if (valid) {\r\n      let data = {\r\n        email: formForgetPwd.value.email,\r\n        code: formForgetPwd.value.code\r\n      }\r\n      forgetData(data).then(res=>{\r\n        console.log(res);\r\n        step.value = 2;\r\n      })\r\n    }\r\n  })\r\n}\r\nfunction updatePassFunc(){\r\n  proxy.$refs.ForgetPwdRef.validate(valid => {\r\n    if (valid) {\r\n      let data = {\r\n        email: formForgetPwd.value.email,\r\n        password: formForgetPwd.value.password\r\n      }\r\n      updatePass(data).then(res=>{\r\n        console.log(res);\r\n        proxy.$modal.msgSuccess(\"修改密码成功\");\r\n        flag.value = 0\r\n      })\r\n    }\r\n  })\r\n}\r\n// 定时器\r\nfunction countDFun(){\r\n \r\n  let countDown = setInterval(()=>{\r\n    let code = flag.value == 1 ? formData.value.code : formForgetPwd.value.code\r\n    if(countD.value == 0){\r\n      clearInterval(countDown)\r\n      // getEmailCode(formData.value.email);\r\n      isSend.value = true\r\n      countD.value = 60\r\n    }else if(countD.value > 0){\r\n      countD.value = countD.value - 1\r\n    }\r\n  },1000)\r\n \r\n \r\n};\r\n// 注册展示\r\nfunction forgetPwd() {\r\n  proxy.$refs.baseInfoForm.resetFields()\r\n  flag.value = 1;\r\n}\r\n// 邮箱验证码\r\nfunction getEmailCode(em){\r\n  if(em.search(/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/) != -1){\r\n    let email = {email: em}\r\n    isSend.value =false\r\n    // 倒计时\r\n    countDFun()\r\n    sendMail(email).then(res=>{\r\n      proxy.$modal.msgSuccess(\"验证码已发送,请注意查收\");\r\n      console.log(res)\r\n    })\r\n  }else if(em == ''){\r\n    proxy.$modal.msgError('邮箱不能为空')\r\n  }\r\n}\r\n// 注册\r\nfunction registerFunc(){\r\n  proxy.$refs.baseInfoForm.validate(valid => {\r\n    if (valid) {\r\n      let data = {\r\n        userName: formData.value.nickName,\r\n        phonenumber: formData.value.phonenumber,\r\n        email: formData.value.email,\r\n        code: formData.value.code,\r\n        password: formData.value.password\r\n      }\r\n      registerData(data).then(res=>{\r\n \r\n        console.log(res)\r\n        proxy.$modal.msgSuccess(\"注册成功\");\r\n        // 返回登录并渲染输入框\r\n        flag.value = 0;\r\n        loginForm.value.phone = data.phonenumber;\r\n        loginForm.value.password = data.password;\r\n        isback.value = true\r\n      })\r\n    }\r\n  });\r\n}\r\n \r\n \r\n \r\n \r\n \r\n \r\n \r\n// 图片验证码\r\nfunction getCode() {\r\n  getCodeImg().then(res => {\r\n    captchaOnOff.value = res.captchaOnOff === undefined ? true : res.captchaOnOff;\r\n    if (captchaOnOff.value) {\r\n      codeUrl.value = \"data:image/gif;base64,\" + res.img;\r\n      loginForm.value.uuid = res.uuid;\r\n    }\r\n  });\r\n}\r\n \r\n// 获取缓存\r\nfunction getCookie() {\r\n  // const username = Cookies.get(\"username\");\r\n  const password = Cookies.get(\"password\");\r\n  const rememberMe = Cookies.get(\"rememberMe\");\r\n  const phone = Cookies.get(\"phone\");\r\n  loginForm.value = {\r\n    phone: phone === undefined ? loginForm.value.phone : phone,\r\n    // username: username === undefined ? loginForm.value.username : username,\r\n    password: password === undefined ? loginForm.value.password : decrypt(password),\r\n    rememberMe: rememberMe === undefined ? false : Boolean(rememberMe)\r\n  };\r\n}\r\n// 记住密码\r\nfunction capctchaCheckSuccess(params) {\r\n  loginForm.value.code = params.captchaVerification;\r\n  loading.value = true;\r\n  // 勾选了需要记住密码设置在cookie中设置记住用户明和名命\r\n  if (loginForm.value.rememberMe) {\r\n    Cookies.set(\"phone\", loginForm.value.phone, { expires: 30 });\r\n    // Cookies.set(\"username\", loginForm.value.username, { expires: 30 });\r\n    Cookies.set(\"password\", encrypt(loginForm.value.password), { expires: 30 });\r\n    Cookies.set(\"rememberMe\", loginForm.value.rememberMe, { expires: 30 });\r\n  } else {\r\n    // 否则移除\r\n    Cookies.remove(\"phone\");\r\n    // Cookies.remove(\"username\");\r\n    Cookies.remove(\"password\");\r\n    Cookies.remove(\"rememberMe\");\r\n  }\r\n \r\n  let data = {\r\n    username:  loginForm.value.phone,\r\n    password: loginForm.value.password,\r\n    code: loginForm.value.code,\r\n    uuid: loginForm.value.uuid\r\n  }\r\n \r\n  // 调用action的登录方法\r\n  store.dispatch(\"Login\", data).then(() => {\r\n    router.push({ path: redirect.value || \"/\" });\r\n  }).catch(() => {\r\n    loading.value = false;\r\n    // 否则移除\r\n    Cookies.remove(\"phone\");\r\n    // Cookies.remove(\"username\");\r\n    Cookies.remove(\"password\");\r\n    Cookies.remove(\"rememberMe\");\r\n \r\n    loginForm.value.phone = '';\r\n    loginForm.value.password = '';\r\n    loginForm.value.rememberMe = false;\r\n  });\r\n}\r\n \r\ngetCookie();\r\n</script>\r\n \r\n<style rel=\"stylesheet/scss\" lang=\"scss\" scoped>\r\n.crmLogin {\r\n  height: 100%;\r\n  overflow-x: hidden;\r\n  background-color: #f8f8f8;\r\n  .left {\r\n    width: 52.344vw;\r\n    height: 100vh;\r\n    background-repeat: no-repeat !important;\r\n    background-size: cover !important;\r\n    overflow: hidden;\r\n    .imgbox {\r\n      width: 33.333vw;\r\n      height: 21.615vw;\r\n      background: rgba(0, 153, 68, 0.35);\r\n      border: 1px solid #009944;\r\n      margin-top: 13.719vw;\r\n      margin-left: 9.115vw;\r\n      .text {\r\n        display: flex;\r\n        align-items: center;\r\n        margin-top: 3.594vw;\r\n        margin-left: 4.271vw;\r\n        height: 4.063vw;\r\n        color: #fff;\r\n        font-size: 1.25vw;\r\n        img {\r\n          width: 3.542vw;\r\n          height: 4.375vw;\r\n        }\r\n        div {\r\n          margin-left: 1.719vw;\r\n        }\r\n      }\r\n \r\n      .cent {\r\n        font-size: 2.083vw;\r\n        font-family: Microsoft YaHei;\r\n        font-weight: bold;\r\n        color: #ffffff;\r\n        margin-top: 2.323vw;\r\n        text-align: center;\r\n      }\r\n      .txt {\r\n        display: inline-block;\r\n        font-size: 1.094vw;\r\n        font-family: Microsoft YaHei;\r\n        font-weight: 400;\r\n        color: #ffffff;\r\n        margin-top: 1.667vw;\r\n        margin-left: 7.292vw;\r\n      }\r\n    }\r\n  }\r\n  .right {\r\n    position: absolute;\r\n    top: 0px;\r\n    right: 0px;\r\n    width: 49.531vw;\r\n    height: 100%;\r\n    background-repeat: no-repeat;\r\n    background-size: cover;\r\n    .loginBox {\r\n      width: 30.557vw;\r\n      margin-left: 10.365vw;\r\n      .title {\r\n        text-align: center;\r\n        font-size: 2.5vw;\r\n        font-family: Adobe Heiti Std;\r\n        font-weight: normal;\r\n        color: #009944;\r\n        margin-top: 9.688vw;\r\n      }\r\n \r\n      :deep(.el-input--default .el-input__inner) {\r\n        height: 3.745vw;\r\n        background-color: rgba(196, 196, 196, 0.13);\r\n        border-radius: 36px;\r\n        border: none;\r\n      }\r\n \r\n      .el-button {\r\n        width: 30.573vw;\r\n        height: 3.75vw;\r\n        background: #337ab7;\r\n        border-radius: 1.25vw;\r\n        font-size: 0.99vw;\r\n        font-weight: 400;\r\n        color: #ffffff;\r\n        margin-top: 2.813vw;\r\n      }\r\n \r\n      .changeBtn {\r\n        display: flex;\r\n        justify-content: space-between;\r\n        font-size: 15px;\r\n        font-weight: 400;\r\n        color: #999999;\r\n      }\r\n    }\r\n  }\r\n \r\n  :deep(.el-input .el-input__inner){\r\n    height: 44px;\r\n  }\r\n  .el-button{\r\n    height: 44px !important;\r\n    background-color: #1f85c5 !important;\r\n    border-radius: 5px;\r\n    color: #ffffff;\r\n    &.is-disabled{\r\n      background: #ddd !important;\r\n      border-color: #ddd !important;\r\n      &:hover{\r\n        background: #ddd !important;\r\n        border-color: #ddd !important;\r\n        color: #fff !important;\r\n      }\r\n    }\r\n  }\r\n}\r\n \r\n// 注册\r\n.register {\r\n  width: 500px;\r\n  height: fit-content;\r\n  background-color: #ffffff;\r\n  box-shadow: 0 0 10px 0  rgba(0, 0, 0, 0.45);\r\n  border-radius: 10px;\r\n  padding: 30px 68px;\r\n  position: absolute;\r\n  right: 184px;\r\n  top: 50%;\r\n  transform: translate(0,-45%);\r\n  .top{\r\n    font-size: 28px;\r\n    color: #1f85c5;\r\n    margin-bottom: 39px;\r\n  }\r\n  .email-code{\r\n    :deep(.el-form-item__content){\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: space-between;\r\n      .el-input{\r\n        width: 240px !important;\r\n      }\r\n      .el-button{\r\n        span{\r\n          font-size: 16px;\r\n        }\r\n      }\r\n    }\r\n  }\r\n  .reg-btns {\r\n    width: 100%;\r\n    margin-top: 40px;\r\n    :deep(.el-button){\r\n      width: 100%;\r\n      span{\r\n        font-size: 18px;\r\n      }\r\n    }\r\n    .back-btn{\r\n      margin-top: 20px;\r\n      text-align: right;\r\n      font-size: 14px;\r\n      color: #6bb6fa;\r\n      cursor: pointer;\r\n    }\r\n  }\r\n}\r\n \r\n.bottom {\r\n  width: 100vw;\r\n  padding: 10px 0;\r\n  background: #ededed;\r\n  // position: fixed;\r\n  bottom: 0;\r\n  font-size: 0.573vw;\r\n  text-align: center;\r\n  div:nth-child(2) {\r\n    margin-top: 10px;\r\n  }\r\n}\r\n \r\n \r\n \r\n.login_cont {\r\n  width: 100%;\r\n  height: 100%;\r\n  overflow: hidden;\r\n \r\n  .loginNewBg {\r\n    height: 100%;\r\n    >img{\r\n      width: 32.96875vw;\r\n      height: 24.79166666666667vw;\r\n      position: absolute;\r\n      left: 0;\r\n      top: 50%;\r\n      transform: translate(50%,-45%);\r\n    }\r\n  }\r\n  .log_content {\r\n    box-sizing: border-box;\r\n    padding: 48px 68px;\r\n    background: #FFFFFF;\r\n    box-shadow: 4px 0 10px 0 rgba(0, 0, 0, 0.45);\r\n    border-radius: 10px;\r\n    width: 500px;\r\n    height: 450px;\r\n    position: absolute;\r\n    right: 184px;\r\n    top: 50%;\r\n    transform: translate(0,-45%);\r\n    :deep(div) {\r\n      .el-input__inner {\r\n        background-color: transparent;\r\n        color: #424f74;\r\n        font-weight: 500;\r\n      }\r\n      .el-form-item__label {\r\n        color: #424f74;\r\n        font-weight: 500;\r\n        padding-bottom: 0;\r\n        line-height: 1;\r\n        margin-bottom: 10px;\r\n      }\r\n      .el-checkbox__label {\r\n        color: #424f74;\r\n      }\r\n      .el-input--default .el-input__inner {\r\n        height: 44px;\r\n        line-height: 44px;\r\n      }\r\n      .el-button {\r\n        background-color: #1678ff;\r\n        height: 44px !important;\r\n        line-height: 44px;\r\n        padding: 0 20px !important;\r\n        font-size: 18px !important;\r\n        width: 143px;\r\n      }\r\n      .el-input--default .el-input__icon {\r\n        line-height: 44px;\r\n        font-size: 16px;\r\n      }\r\n    }\r\n    .wel {\r\n      font-size: 28px;\r\n      font-weight: 400;\r\n      color: #1F85C5;\r\n      margin-bottom: 38px;\r\n    }\r\n    .pass-btn {\r\n      font-size: 14px;\r\n      font-weight: 400;\r\n      color: #969CB3;\r\n    }\r\n    .register-btn{\r\n      font-size: 14px;\r\n      font-weight: 400;\r\n      color: #969CB3;\r\n      line-height: 24px;\r\n      cursor: pointer;\r\n      text-align: center;\r\n      span{\r\n        color: #6BB6FA;\r\n      }\r\n    }\r\n  }\r\n \r\n}\r\n//底部\r\n.log_bottom {\r\n  width: 100%;\r\n  height: 100px;\r\n  font-size: 12px;\r\n  font-weight: 400;\r\n  color: #5A5A5A;\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n \r\n//顶部\r\n.top-box{\r\n  height: 200px;\r\n  padding: 50px;\r\n  img{\r\n    width: 366px;\r\n    height: 103px;\r\n    }\r\n}\r\n \r\n//中部\r\n.mid-box{\r\nheight:calc(100vh - 300px);\r\nbackground: #5B719D;\r\n}\r\n \r\n \r\n.mask{\r\n  height: 450px;\r\n}\r\n \r\n:deep(span.el-input__prefix-inner){\r\n  display: flex;\r\n  align-items: center;\r\n  width: 24px;\r\n  justify-content: center;\r\n  margin-left: -5px;\r\n  img {\r\n    height: 14px;\r\n    display: block;\r\n  }\r\n  >i{\r\n    display: none;\r\n  }\r\n}\r\n</style>\r\n\r\n\r\n"]},"metadata":{},"sourceType":"module"}